(function(){var ImagePicker,ImageUpload,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ImageUpload=function(superClass){extend(ImageUpload,superClass);function ImageUpload(){return ImageUpload.__super__.constructor.apply(this,arguments)}ImageUpload.prototype.success_params={type:"layout",thumb_size:"original"};return ImageUpload}(I.ImageUpload);ImagePicker=function(){function ImagePicker(el,editor,update){this.editor=editor;if(update==null){update=null}if(update){this.update=update}this.el=$(el);this.make_upload_btn();this.el.dispatch("click",{remove_image_btn:function(_this){return function(btn){_this.el.removeClass("has_image").find(".image_preview").css("background-image","").end().find(".image_id_input").val("").end().data("image_url","");return _this.send_update()}}(this)});this.el.on("change",function(_this){return function(e){return _this.send_update()}}(this));this.send_update()}ImagePicker.prototype.upload_prefix=function(){return this.editor.upload_prefix()};ImagePicker.prototype.prepare_upload=function(fn){return typeof fn==="function"?fn():void 0};ImagePicker.prototype.update=function(){};ImagePicker.prototype.send_update=function(){var i,len,name,option,opts,ref,url;name=this.el.data("image_name");url=this.el.data("image_url");if(!url){return this.update(name,void 0)}opts={url:url};ref=this.el.find(".image_option");for(i=0,len=ref.length;i<len;i++){option=ref[i];option=$(option);opts[option.data("name")]=option.find("select").val()}return this.update(name,opts)};ImagePicker.prototype.make_upload_btn=function(){var btn;if(this.upload_btn){return}this.progress_inner||(this.progress_inner=this.el.find(".progress_inner"));btn=this.el.find(".upload_image_btn");return this.upload_btn=I.make_popup_upload_button(this,btn,ImageUpload,{start_uploading:function(_this){return function(){_this.progress_inner.css({width:""});return _this.el.addClass("uploading")}}(this),finish_upload:function(_this){return function(upload,file){_this.el.removeClass("uploading").addClass("has_image").find(".image_preview").css("background-image","url("+file.url+")").end().find(".image_id_input").val(file.id).end().data("image_url",file.url);return _this.send_update()}}(this)})};return ImagePicker}();I.AppearanceEditor=function(){AppearanceEditor.ImageUpload=ImageUpload;AppearanceEditor.ImagePicker=ImagePicker;function AppearanceEditor(el,data){this.data=data;this.set_height=bind(this.set_height,this);this.css_template=bind(this.css_template,this);this.el=$(el);this.style=_.extend({},this.data);this.refresh_style=_.debounce(function(_this){return function(){return _this.constructor.prototype.refresh_style.apply(_this,arguments)}}(this),0);this.setup_color_picker();this.setup_image_picker();this.setup_text_areas();this.setup_form();this.el.dispatch("click",{toggle_editor_btn:function(_this){return function(){return _this.toggle()}}(this)});if(window.location.hash.match(/\bedit\b/)){_.defer(function(_this){return function(){return _this.toggle()}}(this))}$(window).on("resize",_.debounce(function(_this){return function(){return _this.set_height()}}(this),100))}AppearanceEditor.prototype.css_template=function(){var template_code;if(!this.css_template_fn){template_code=this.el.data("css_template");if(!template_code){return}this.css_template_fn=eval(template_code)}return this.css_template_fn.apply(this,arguments)};AppearanceEditor.prototype.set_height=function(){var html_h,inner,inner_h,real_height,win_h;inner=this.el.find(".appearance_editor_inner");html_h=$("html").outerHeight(true);win_h=$(window).height();inner_h=inner.outerHeight(true);if(inner_h>win_h){real_height=Math.max(html_h,win_h,inner_h);return this.el.height(real_height).css({bottom:"",position:""})}else{return this.el.height("").css({bottom:"0",position:"fixed"})}};AppearanceEditor.prototype.toggle=function(){var body;body=$(document.body).toggleClass("show_appearance_editor");this.set_height();this.el.addClass("animating");return setTimeout(function(_this){return function(){_this.el.removeClass("animating");return _this.set_height()}}(this),200)};AppearanceEditor.prototype.refresh_style=function(){};AppearanceEditor.prototype.upload_prefix=function(){throw"override me"};AppearanceEditor.prototype.update_image=function(name,image){this.style[name]=image;return this.refresh_style()};AppearanceEditor.prototype.update_color=function(name,color){this.style[name]=color;return this.refresh_style()};AppearanceEditor.prototype.setup_form=function(){return this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "))}}}(this))};AppearanceEditor.prototype.setup_text_areas=function(){return this.el.on("focusin focusout",".text_field",function(_this){return function(e){return $(e.currentTarget).toggleClass("open",e.type==="focusin")}}(this))};AppearanceEditor.prototype.setup_image_picker=function(){var el,image_pickers;image_pickers=this.el.find(".image_picker");return this.image_pickers=function(){var i,len,results;results=[];for(i=0,len=image_pickers.length;i<len;i++){el=image_pickers[i];results.push(new ImagePicker($(el),this,function(_this){return function(){return _this.update_image.apply(_this,arguments)}}(this)))}return results}.call(this)};AppearanceEditor.prototype.setup_color_picker=function(){var i,len,picker,pickers;this.el.dispatch("click",{color_preview:function(_this){return function(btn){return _this.open_color_picker(btn.closest(".color_picker"))}}(this)});this.el.on("click",".color_picker .close_btn",function(_this){return function(e){var picker;picker=$(e.target).closest(".color_picker");return picker.data("close")()}}(this));this.el.find("input[type='text']").on("focus",function(_this){return function(e){return _this.open_color_picker($(e.target).closest(".color_picker"),false)}}(this));pickers=this.el.find(".color_picker");for(i=0,len=pickers.length;i<len;i++){picker=pickers[i];picker=$(picker);this.set_picker_color(picker,this.style[picker.find("[data-name]").data("name")])}pickers.on("keyup","input",function(_this){return function(e){var color,ref;color=$(e.currentTarget).val();return(ref=$(e.delegateTarget).data("farb"))!=null?ref.setColor(color):void 0}}(this));return pickers.on("change","input",function(_this){return function(e){var color,ref;picker=$(e.delegateTarget);if(color=(ref=picker.data("farb"))!=null?ref.color:void 0){return picker.find("input").val(color)}}}(this))};AppearanceEditor.prototype.set_picker_color=function(picker,color){var farb,h,input,l,preview,ref,s;farb=picker.data("farb")||new $._farbtastic($());input=picker.find("input");if(color){input.val(color)}else{color=input.val()}preview=picker.find(".color_preview");input=picker.find("input");ref=farb.RGBToHSL(farb.unpack(color)),h=ref[0],s=ref[1],l=ref[2];preview.toggleClass("is_bright",l>.9);preview.css("backgroundColor",color);return this.update_color(picker.find("[data-name]").data("name"),color)};AppearanceEditor.prototype.open_color_picker=function(picker,toggle){var base,farb,i,input,len,other_picker,popup,preview,ref;if(toggle==null){toggle=true}if(picker.is(".flyout_open")){if(toggle){picker.data("close")()}return false}ref=this.el.find(".color_picker");for(i=0,len=ref.length;i<len;i++){other_picker=ref[i];if(typeof(base=$(other_picker).data("close"))==="function"){base()}}popup=$('<div class="color_popup input_flyout">\n  <div class="close_btn">&times;</div>\n  <div class="farb"></div>\n</div>');input=picker.find("input");preview=picker.find(".color_preview");picker.data("close",function(_this){return function(){popup.removeClass("open");picker.removeClass("flyout_open").removeData("farb");$(document.body).off("click.color_picker");$(window).off("keydown.color_picker");return setTimeout(function(){return popup.remove()},200)}}(this));farb=$.farbtastic(popup.find(".farb"),function(_this){return function(color){return _this.set_picker_color(picker,color)}}(this));picker.data("farb",farb);farb.setColor(input.val());$(document.body).on("click.color_picker",function(_this){return function(e){if($(e.target).closest(".color_picker").length){return}return picker.data("close")()}}(this));$(window).on("keydown.color_picker",function(_this){return function(e){if(e.keyCode===27){return picker.data("close")()}}}(this));picker.append(popup).addClass("flyout_open");return _.defer(function(_this){return function(){return popup.addClass("open")}}(this))};return AppearanceEditor}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.AddGameToJamForm=function(){function AddGameToJamForm(el,opts){if(opts==null){opts={}}this.setup_badge_fields=bind(this.setup_badge_fields,this);this.setup_public_domain_fields=bind(this.setup_public_domain_fields,this);this.opts=$.extend({remote_submit:false},opts);this.el=$(el);this.form=this.el.is("form")&&this.el||this.el.find("form");this.setup_remote_submit();this.setup_public_domain_fields();this.setup_badge_fields();this.setup_game_picker()}AddGameToJamForm.prototype.setup_game_picker=function(){var game_id_input,update_game_id,url_template;game_id_input=this.el.find(".game_id_input");if(!game_id_input.length){return}url_template=_.template(this.form.attr("action"));update_game_id=function(_this){return function(){var url;if(!game_id_input.length){return}url=url_template({game_id:game_id_input.val()});return _this.form.attr("action",url)}}(this);update_game_id();return game_id_input.on("change",update_game_id)};AddGameToJamForm.prototype.setup_remote_submit=function(){if(!this.opts.remote_submit){return}$('<input type="hidden" name="json" value="true" />').appendTo(this.form);return this.form.remote_submit(function(_this){return function(res){var base;if(res.errors){return alert(res.errors.join(", "))}return typeof(base=_this.opts).on_submit==="function"?base.on_submit(res):void 0}}(this))};AddGameToJamForm.prototype.setup_public_domain_fields=function(){var data,field,i,len,ref,val;this.el.on("change",".field_type_public_domain",function(_this){return function(e){var field,val_input;field=$(e.currentTarget);val_input=field.find(".field_value");return val_input.val(field.find(".public_domain_toggle").is(":checked")?JSON.stringify([field.find(".country_input").val()]):"")}}(this));ref=this.el.find(".field_type_public_domain");for(i=0,len=ref.length;i<len;i++){field=ref[i];field=$(field);val=field.find(".field_value").val();try{data=JSON.parse(val)}catch(error){}if(!data){return}field.find(".public_domain_toggle").prop("checked",true);field.find("option[value='"+data[0]+"']").prop("selected",true)}};AddGameToJamForm.prototype.setup_badge_fields=function(){var data,field,i,idx,j,len,len1,ref,toggle,val;this.el.on("change",".field_type_badges",function(_this){return function(e){var el,field,selected,val_input;field=$(e.currentTarget);val_input=field.find(".field_value");selected=function(){var i,len,ref,results;ref=field.find("input.badge_toggle:checked");results=[];for(i=0,len=ref.length;i<len;i++){el=ref[i];results.push(""+$(el).data("choice_idx"))}return results}();return val_input.val(selected.length?JSON.stringify(selected):"")}}(this));ref=this.el.find(".field_type_badges");for(i=0,len=ref.length;i<len;i++){field=ref[i];field=$(field);val=field.find(".field_value").val();try{data=JSON.parse(val)}catch(error){}if(!data){return}for(j=0,len1=data.length;j<len1;j++){idx=data[j];toggle=field.find("[data-choice_idx='"+idx+"']");toggle.prop("checked",true)}}};return AddGameToJamForm}()}).call(this);(function(){var CoverImageUpload,lazy_template,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};lazy_template=I.lazy_template;CoverImageUpload=function(superClass){extend(CoverImageUpload,superClass);function CoverImageUpload(){return CoverImageUpload.__super__.constructor.apply(this,arguments)}CoverImageUpload.prototype.label="cover image";CoverImageUpload.prototype.success_params={type:"cover",thumb_size:"cover_big"};CoverImageUpload.prototype.upload_params=function(){var params;params=CoverImageUpload.__super__.upload_params.apply(this,arguments);params.type="cover";return params};return CoverImageUpload}(I.AppearanceEditor.ImageUpload);I.EditJam=function(){EditJam.prototype.date_format="yy-mm-dd";EditJam.prototype.time_format="HH:mm:ss";EditJam.prototype.field_template=lazy_template(EditJam,"field");function EditJam(el,jam1){var content_input,ref;this.jam=jam1;this.setup_date_pickers=bind(this.setup_date_pickers,this);this.render_criteria_editor=bind(this.render_criteria_editor,this);this.el=$(el);content_input=this.el.find(".content_input");if((ref=this.jam)!=null?ref.html_enabled:void 0){CodeMirror.fromTextArea(content_input[0],{mode:"htmlmixed",lineNumbers:true,tabSize:2})}else{I.redactor(content_input)}I.redactor(this.el.find(".submission_details_input"),{minHeight:80,buttons:["bold","italic","underline","deleted","unorderedlist","orderedlist","link"]});this.render_criteria_editor();this.setup_field_picker();this.setup_date_pickers();this.setup_timezone();this.setup_type_picker();this.setup_cover();this.el.dispatch("click",{delete_jam_btn:function(_this){return function(btn){if(confirm("Are you sure you want to delete this jam? This can't be undone.")){btn.addClass("disabled");return $.ajax({type:"post",data:I.with_csrf(),url:btn.data("url"),success:function(res){return window.location=res.redirect_to||"/"}})}}}(this)});(this.form=this.el.find("form")).remote_submit(function(_this){return function(res){var ref1,ref2,url;if(res.errors){_this.render_errors(res.errors);return}if(url=((ref1=res.jam)!=null?ref1.url:void 0)||_this.redirect_on_save){window.location=url}else{I.flash("Jam saved")}if(res.fields!=null){_this.set_field_ids(res.fields)}if(res.criteria){return(ref2=_this.criteria_editor)!=null?ref2.setState({criteria:res.criteria}):void 0}}}(this));I.slug_input(this.el.find(".slug_input"),this.el.find(".title_input"));I.setup_dirty_warning(this.form)}EditJam.prototype.save_jam=function(callback){return this.el.find("form").trigger("submit",[callback])};EditJam.prototype.render_errors=function(errors){return this.form.set_form_errors(errors,true,"There was a problem with your submission")};EditJam.prototype.set_field_ids=function(ids){var i,idx,input,len,ref,results,row;idx=0;ref=this.field_picker.find(".field_row");results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];row=$(row);input=row.find(".field_id_input");if(!input.length){input=$('<input type="hidden" class="field_id_input" />').attr("name","jam[fields]["+row.data("field_position")+"][id]").prependTo(row)}results.push(input.val(ids[idx++]))}return results};EditJam.prototype.reorder_fields=function(start){var i,idx,input,len,ref,results,row;if(start==null){start=1}ref=this.field_picker.find(".field_row");results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];idx=start++;row=$(row);row.data("field_position",idx);results.push(function(){var j,len1,ref1,results1;ref1=row.find("[name]");results1=[];for(j=0,len1=ref1.length;j<len1;j++){input=ref1[j];input=$(input);results1.push(input.attr("name",input.attr("name").replace(/\d+/,idx)))}return results1}())}return results};EditJam.prototype.render_criteria_editor=function(){var el,ref;el=this.criteria_drop||this.el.find(".criteria_drop");if(!el.length){return}return this.criteria_editor=ReactDOM.render(R.JamEdit.EditCriteria({criteria:_.toArray((ref=this.jam)!=null?ref.criteria:void 0),can_edit:!this.jam||this.jam.can_edit_criteria||false}),el[0])};EditJam.prototype.setup_field_picker=function(){var field,i,j,len,len1,list,ref,ref1,ref2,update_field_state;this.field_picker=this.el.find(".field_picker");if(!this.field_picker.length){return}list=this.field_picker.find(".field_list");this.field_picker.dispatch("click",{move_up_btn:function(_this){return function(btn){var crit;crit=btn.closest(".field_row");crit.swap_with(crit.prev());return _this.reorder_fields()}}(this),move_down_btn:function(_this){return function(btn){var crit;crit=btn.closest(".field_row");crit.swap_with(crit.next());return _this.reorder_fields()}}(this),remove_btn:function(_this){return function(btn){btn.closest(".field_row").remove();return _this.reorder_fields()}}(this),add_field_btn:function(_this){return function(btn){list.append(_this.field_template({idx:0,id:false,name:"",description:"",required:false,private:false,type:"",data:""}));return _this.reorder_fields()}}(this)});if((ref=this.jam)!=null?ref.fields:void 0){ref1=this.jam.fields;for(i=0,len=ref1.length;i<len;i++){field=ref1[i];list.append(this.field_template(field))}}update_field_state=function(field){var type_el;type_el=field.find(".field_type_picker").find(":selected");return field.toggleClass("has_data",!!type_el.data("has_data"))};ref2=this.field_picker.find(".field_row");for(j=0,len1=ref2.length;j<len1;j++){field=ref2[j];update_field_state($(field))}this.field_picker.on("change",".field_type_picker",function(_this){return function(e){return update_field_state($(e.currentTarget).closest(".field_row"))}}(this));if(!(!this.jam||this.jam.can_edit_fields)){return this.field_picker.find("input, select, textarea").prop("disabled",true).end()}};EditJam.prototype.setup_date_pickers=function(){var all_pickers,end_picker,start_picker,voting_end_picker;start_picker=this.el.find(".date_picker.start_date");end_picker=this.el.find(".date_picker.end_date");voting_end_picker=this.el.find(".date_picker.voting_end_date");all_pickers=this.el.find(".date_picker");return I.datetimepicker(all_pickers,{onSelect:function(val){}})};EditJam.prototype.setup_timezone=function(){var tz;tz=jstz.determine().name();this.el.find(".timezone_input").val(tz);return this.el.find(".timezone_label").text(tz)};EditJam.prototype.setup_type_picker=function(){this.type_picker=this.el.find(".jam_type_picker");return this.type_picker.on("change",function(_this){return function(e){var type;type=$(e.target).val();return _this.el.removeClass("type_ranked type_non_ranked").addClass("type_"+type)}}(this))};EditJam.prototype.with_jam=function(fn,fail_fn){if(this.jam){return typeof fn==="function"?fn(this.jam):void 0}else{return this.save_jam(function(_this){return function(res){if(res.errors){_this.render_errors(res.errors);alert("Please fix the errors before uploading an image");if(typeof fail_fn==="function"){fail_fn()}return}_this.jam=res.jam;_this.form.attr("action",_this.jam.edit_url);_this.redirect_on_save=_this.jam.url;return typeof fn==="function"?fn():void 0}}(this))}};EditJam.prototype.upload_prefix=function(){return"/jam/"+this.jam.id};EditJam.prototype.prepare_upload=function(fn,fail_fn){return this.with_jam(function(_this){return function(jam){return fn()}}(this))};EditJam.prototype.setup_cover=function(){var btn,ref;this.cover=this.el.find(".cover_image");btn=this.cover.find(".upload_cover_btn");I.make_upload_button(this,btn,CoverImageUpload,{start_uploading:function(_this){return function(){return _this.cover.addClass("loading")}}(this),stop_uploading:function(_this){return function(){return _this.cover.removeClass("loading")}}(this),cancel_upload:function(_this){return function(upload,error){return alert(error)}}(this),finish_upload:function(_this){return function(upload,res){return _this.set_cover_image(res.url)}}(this)});if((ref=this.jam)!=null?ref.cover_url:void 0){this.set_cover_image(this.jam.cover_url)}return this.cover.on("click",".delete_cover_btn",function(_this){return function(){if(!_this.cover.hasClass("has_image")){return}if(!confirm("Are you sure you want to delete the cover image?")){return}_this.set_cover_image(null);return I.ImageUpload.delete_image(_this,"cover-image")}}(this))};EditJam.prototype.set_cover_image=function(url){this.cover.toggleClass("has_image",!!url);url=url?"url("+url+")":"";return this.cover.css("background-image",url)};return EditJam}()}).call(this);(function(){I.JamAdmin=function(){function JamAdmin(el,jam){var appearance_editor;this.jam=jam;this.el=$(el);appearance_editor=this.el.find(".appearance_editor_widget");if(appearance_editor.length){this.appearance_editor=new I.JamAppearanceEditor(appearance_editor,{},this.jam)}this.el.dispatch("click",{edit_theme_btn:function(_this){return function(btn){return _this.appearance_editor.toggle()}}(this)})}return JamAdmin}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.JamAppearanceEditor=function(superClass){extend(JamAppearanceEditor,superClass);function JamAppearanceEditor(_a,_b,jam){this.jam=jam;this.refresh_style=bind(this.refresh_style,this);JamAppearanceEditor.__super__.constructor.apply(this,arguments);this.page=$(".view_jam_page");this.css_input=this.el.find(".css_input").on("change",function(_this){return function(){return _this.refresh_style()}}(this)).on("keyup",_.debounce(function(_this){return function(){return _this.refresh_style()}}(this),300))}JamAppearanceEditor.prototype.upload_prefix=function(){return"/jam/"+this.jam.id};JamAppearanceEditor.prototype.refresh_style=function(){var background_image_css,banner_image,bg_highlight,bg_sub,body_border_color,button_bg_color,button_fg_color,button_shadow,css,custom_css,img,inside_bg,link_highlight,link_sub,position,ref,text_sub_1,text_sub_2;banner_image=this.style.banner_image;this.page.toggleClass("has_banner",!!banner_image);if(banner_image){this._banner_el||(this._banner_el=this.page.find(".jam_banner"));this._banner_el.attr("src",banner_image.url).toggleClass("full_width",banner_image.size==="full")}this._style||(this._style=$("#jam_theme"));inside_bg=this.style.bg_color2;bg_sub=I.Color.sub_color2(inside_bg,.1);bg_highlight=I.Color.sub_color2(bg_sub,.05);text_sub_1=I.Color.sub_color2(inside_bg,.6);text_sub_2=I.Color.sub_color2(inside_bg,.45);link_highlight=I.Color.sub_color2(this.style.link_color,.05);link_sub=I.Color.sub_color2(this.style.link_color,-.05);button_fg_color=I.Color.readable_text_color(this.style.link_color);button_bg_color=this.style.link_color;if(button_bg_color==="#dd4a4a"){button_bg_color="#FA5C5C"}button_shadow=I.Color.sub_color2(button_bg_color,.17,.2);background_image_css=(img=this.style.background_image)?(position=function(){var ref;switch((ref=this.style.background_image)!=null?ref.position:void 0){case"align_left":return"0% 0%";case"align_right":return"100% 0%";case"align_center":return"50% 0%";default:return"0% 0%"}}.call(this),'background-image: url("'+img.url+'");\nbackground-repeat: '+(img.repeat||"repeat")+";\nbackground-position: "+position+";"):"";custom_css=I.strip_css(this.css_input.val()||"");body_border_color=this.style.bg_color===this.style.bg_color2&&!this.style.background_image?bg_sub:"transparent";css=this.css_template({text_color:this.style.text_color,bg_color:this.style.bg_color,bg_color2:this.style.bg_color2,link_color:this.style.link_color,body_border_color:body_border_color,button_shadow:button_shadow,background_image_css:background_image_css,button_fg_color:button_fg_color,button_bg_color:button_bg_color,link_highlight:link_highlight,link_sub:link_sub,bg_sub:bg_sub,bg_highlight:bg_highlight,text_sub_1:text_sub_1,text_sub_2:text_sub_2,custom_css:custom_css});if((ref=this._style)!=null){ref.remove()}return this._style=$("<style type='text/css'>"+css+"</style>").appendTo($("head"))};return JamAppearanceEditor}(I.AppearanceEditor)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.JamParticipants=function(){function JamParticipants(el,opts){var Graph;if(opts==null){opts={}}this.el=$(el);new I.FilterPickers(el);if(opts.participants_graph){Graph=function(superClass){extend(Graph,superClass);function Graph(){this.get_y=bind(this.get_y,this);return Graph.__super__.constructor.apply(this,arguments)}Graph.prototype.get_y=function(d){return d.sum};Graph.prototype.format_data=I.CumulativeGraph.prototype.format_data;return Graph}(I.Grapher);new Graph("#participants_graph",opts.participants_graph,{label:"Cumulative participants",range_left:opts.graph_left,range_right:opts.graph_right,x_ticks:7,min_y:10})}}return JamParticipants}()}).call(this);(function(){var parse_timestamp;window.J={};$.easing.easeInOutQuad=function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b};parse_timestamp=function(str){str=str.replace(/\.\d+$/,"");return moment.utc(str,"YYYY-MM-DD HH:mm:ss").toDate()};J.Jams=function(){function Jams(jams){var j,jam_data;this.jams_by_id={};this.jams=function(){var i,len,results;results=[];for(i=0,len=jams.length;i<len;i++){jam_data=jams[i];j=new J.Jam(jam_data);this.jams_by_id[jam_data.id]=j;results.push(j)}return results}.call(this)}Jams.prototype.truncate=function(time){return this.jams=_.reject(this.jams,function(_this){return function(jam){return jam.end_date()<time}}(this))};Jams.prototype.find_in_progress=function(){return _.filter(this.jams,function(_this){return function(jam){return jam.in_progress()}}(this))};Jams.prototype.find_in_before_start=function(){return _.filter(this.jams,function(_this){return function(jam){return jam.before_start()}}(this))};Jams.prototype.find_in_range=function(start,end){return _.filter(this.jams,function(_this){return function(jam){return jam.collides_with(start,end)}}(this))};return Jams}();J.Jam=function(){function Jam(data){this.data=data}Jam.prototype.length=function(){return this.end_date()-this.start_date()};Jam.prototype.date_format=function(date,name){var f,is_loose;is_loose=this["_"+name+"_date_loose"];f="ll";if(!is_loose){f=f+" H:mm"}return moment(date).format(f)};Jam.prototype.collides_with=function(range_start,range_end){if(+this.start_date()>+range_end){return false}if(+this.end_date()<+range_start){return false}return true};Jam.prototype.in_progress=function(){var now;now=+new Date;return now>=+this.start_date()&&now<=+this.end_date()};Jam.prototype.before_start=function(){var now;now=+new Date;return now<+this.start_date()};Jam.prototype.after_end=function(){var now;now=+new Date;return now>+this.end_date()};Jam.prototype.start_date=function(){return this._start_date||(this._start_date=parse_timestamp(this.data.start_date))};Jam.prototype.end_date=function(){return this._end_date||(this._end_date=parse_timestamp(this.data.end_date))};Jam.prototype.voting_end_date=function(){return this._voting_end_date||(this._voting_end_date=parse_timestamp(this.data.voting_end_date))};return Jam}();J.Calendar=function(){Calendar.prototype.default_color=[149,52,58];Calendar.prototype.day_width=120;Calendar.prototype.cell_height=40;function Calendar(el,jams1){this.jams=jams1;this.el=$(el);this.render_jams();this.render_day_markers();this.render_month_markers();this.render_elapsed_time();this.setup_scrollbar();this.setup_fixed_labels();this.scroll_to_date(new Date);this.setup_dragging()}Calendar.prototype.setup_scrollbar=function(){var scrollbar_outer,update_scroll;if(I.is_mobile()){return}scrollbar_outer=$('<div class="scrollbar_outer">\n  <div class="scrollbar"></div>\n</div>').appendTo(this.el);this.scrollbar=scrollbar_outer.find(".scrollbar");setTimeout(function(_this){return function(){return _this.scrollbar.addClass("visible")}}(this),0);update_scroll=function(_this){return function(){var inner_width,left,width;left=_this.calendar.scrollLeft();width=_this.calendar.width();inner_width=_this.scroller.width();return _this.scrollbar.css({left:Math.floor(left/inner_width*width)+"px",right:Math.floor((inner_width-(left+width))/inner_width*width)+"px"})}}(this);if(I.support_passive_scroll()){this.calendar[0].addEventListener("scroll",update_scroll,{passive:true})}else{this.calendar.on("scroll",update_scroll)}return update_scroll()};Calendar.prototype.move_calendar=function(dx,dy){this.calendar.scrollLeft(this.calendar.scrollLeft()-dx);return typeof this.update_labels==="function"?this.update_labels():void 0};Calendar.prototype.setup_mobile_dragging=function(){var update_scroll;this.calendar.addClass("mobile_scrolling");update_scroll=_.debounce(function(_this){return function(){return typeof _this.update_labels==="function"?_this.update_labels():void 0}}(this),200);if(I.support_passive_scroll()){return this.calendar[0].addEventListener("scroll",update_scroll,{passive:true})}else{return this.calendar.on("scroll",update_scroll)}};Calendar.prototype.setup_dragging=function(){if(I.is_mobile()){return this.setup_mobile_dragging()}this.calendar.draggable({skip_drag:function(_this){return function(e){if($(e.target).closest("a").length){return true}}}(this),move:function(_this){return function(dx,dy){return _this.move_calendar(dx,dy)}}(this)});this.el.find(".scrollbar").draggable({move:function(_this){return function(dx,dy){var scale;scale=_this.scroller.width()/_this.calendar.width();return _this.move_calendar(dx*-scale,dy)}}(this)});return this.el.on("click",".scrollbar_outer",function(_this){return function(e){var left,left_mouse,width;if($(e.target).is(".scrollbar")){return}left=$(e.currentTarget).find(".scrollbar").offset().left;left_mouse=e.pageX;width=Math.floor(_this.scroller.width()/10);if(left_mouse<left){return _this.move_calendar(width,0)}else{return _this.move_calendar(-width,0)}}}(this))};Calendar.prototype.setup_fixed_labels=function(){var initial_margin;initial_margin=I.is_mobile()?0:20;this.update_labels=function(_this){return function(){var el,i,label,label_width,left,len,margin_left,max_right,parent,ref,results,right,viewport_left,viewport_right,visible;viewport_left=_this.calendar.scrollLeft();viewport_right=viewport_left+_this.calendar.width();_this.fixed_labels||(_this.fixed_labels=function(){var i,len,ref,results;ref=this.calendar.find(".fixed_label");results=[];for(i=0,len=ref.length;i<len;i++){el=ref[i];results.push($(el))}return results}.call(_this));ref=_this.fixed_labels;results=[];for(i=0,len=ref.length;i<len;i++){label=ref[i];parent=label.parent();left=parent.position().left;right=left+parent.width();visible=right>=viewport_left&&left<=viewport_right;parent.toggleClass("visible",visible);label_width=label.outerWidth();margin_left=viewport_left+initial_margin-left;margin_left=margin_left>0?(max_right=right-left-label_width,margin_left=Math.min(margin_left,max_right),margin_left+"px"):"0px";if(label.data("margin_left")!==margin_left){label.css("transform","translate("+margin_left+", 0)");results.push(label.data("margin_left",margin_left))}else{results.push(void 0)}}return results}}(this);return this.update_labels()};Calendar.prototype.scroll_to_date=function(date){return this.calendar.animate({scrollLeft:this.x_scale(date-this.calendar.width()/2/this.x_ratio())},{duration:600,easing:"easeInOutQuad",progress:function(_this){return function(){return typeof _this.update_labels==="function"?_this.update_labels():void 0}}(this)})};Calendar.prototype.x_ratio=function(){return this.scroller.width()/(this.end_date()-this.start_date())};Calendar.prototype.x_scale=function(date){return Math.floor((date-+this.start_date())*this.x_ratio())};Calendar.prototype.x_scale_truncated=function(date){return Math.min(this.scroller.width(),Math.max(0,this.x_scale(date)))};Calendar.prototype.jam_color=function(jam,dh,ds,dl){var h,l,ref,s;if(dh==null){dh=0}if(ds==null){ds=0}if(dl==null){dl=0}if(!jam.color){this.default_color[0]+=27;jam.color=[this.default_color[0],this.default_color[1],this.default_color[2]]}ref=jam.color,h=ref[0],s=ref[1],l=ref[2];if(jam.after_end()){s/=6}return"hsl("+(h+dh)+", "+(s+ds)+"%, "+(l+dl)+"%)"};Calendar.prototype.render_elapsed_time=function(){var el;return el=$('<div class="elapsed_time"></div>').css("width",this.x_scale(new Date)).appendTo(this.scroller)};Calendar.prototype.render_month_markers=function(){var curr,curr_end,end,left,marker,markers,results,right;markers=$("<div class='month_markers'></div>").appendTo(this.scroller);curr=moment(this.start_date()).date(1).hours(0).minutes(0).seconds(0).milliseconds(0);end=+this.end_date();results=[];while(+curr.toDate()<end){curr_end=curr.clone().add("month",1);left=this.x_scale_truncated(curr.toDate());right=this.x_scale_truncated(curr_end.toDate());marker=$('<div class="month_marker">\n  <span class="fixed_label">\n    '+curr.format("MMMM")+"\n  </span>\n</div>").css({left:left+"px",width:right-left+"px"}).appendTo(markers);results.push(curr=curr_end)}return results};Calendar.prototype.render_day_markers=function(){var curr,curr_end,day_length,end,left,marker,markers,results,right;day_length=1e3*60*60*24;markers=$("<div class='day_markers'></div>").appendTo(this.scroller);curr=moment(this.start_date());end=+this.end_date();results=[];while(+curr.toDate()<end){curr_end=curr.clone().add("day",1);left=this.x_scale_truncated(curr.toDate());right=this.x_scale_truncated(curr_end.toDate());marker=$("<div class='day_marker'>\n  <div class='day_ordinal'>"+curr.format("Do")+"</div>\n  <div class='day_name'>"+curr.format("ddd")+"</div>\n</div>").css({width:right-left+"px",left:left+"px"}).appendTo(markers);results.push(curr=curr_end)}return results};Calendar.prototype.render_jams=function(){var cell,cells,i,jam,jam_el,jams,k,left,len,len1,len2,len3,m,n,outer_width,results,row,row_el,rows_el,stacked,start,total_days,width;start=new Date;cells=this.el.find(".jam_cell");for(i=0,len=cells.length;i<len;i++){cell=cells[i];cell=$(cell);jam=this.jams.jams_by_id[cell.data("jam_id")];jam.el=cell}cells.remove();this.calendar=this.el.find(".calendar");if(!this.calendar.length){this.calendar=$("<div class='calendar'></div>").appendTo(this.el)}this.calendar.empty();this.calendar.remove();jams=this.jams.find_in_range(this.start_date(),this.end_date());stacked=this.stack_jams(jams);total_days=(this.end_date()-this.start_date())/(1e3*60*60*24);outer_width=this.day_width*total_days;this.scroller=$("<div class='calendar_scrolling'></div>").width(outer_width).height(40*3+6+stacked.length*(this.cell_height+3)).appendTo(this.calendar);rows_el=$("<div class='calendar_rows'></div>").appendTo(this.scroller);for(k=0,len1=stacked.length;k<len1;k++){row=stacked[k];row_el=$("<div class='calendar_row'></div>").appendTo(rows_el);for(m=0,len2=row.length;m<len2;m++){jam=row[m];left=this.x_scale_truncated(jam.start_date());width=this.x_scale_truncated(jam.end_date())-left;jam_el=jam.el.appendTo(row_el).css({backgroundColor:this.jam_color(jam),textShadow:"1px 1px 1px "+this.jam_color(jam,0,0,-10),left:left+"px",width:width+"px"})}}this.el.append(this.calendar);results=[];for(n=0,len3=cells.length;n<len3;n++){cell=cells[n];jam_el=$(cell);if(jam_el.find(".fixed_label").width()>jam_el.width()){results.push(jam_el.addClass("small_text"))}else{results.push(void 0)}}return results};Calendar.prototype.sort_by_length=function(jams){var days,i,jam,len,long,order,rest,short;days=1e3*60*60*24*12;short=[];long=[];rest=[];for(i=0,len=jams.length;i<len;i++){jam=jams[i];if(jam.length()<days){short.push(jam)}else{if(jam.after_end()){rest.push(jam)}else{long.push(jam)}}}short.sort(function(a,b){return a.length()-b.length()});long.sort(function(a,b){return b.length()-a.length()});order=short.concat(long).concat(rest);return order};Calendar.prototype.stack_jams=function(jams){var collided,i,jam,k,len,len1,len2,m,other_jam,placed,row,rows;rows=[];this.sort_by_length(jams);for(i=0,len=jams.length;i<len;i++){jam=jams[i];placed=false;for(k=0,len1=rows.length;k<len1;k++){row=rows[k];collided=false;for(m=0,len2=row.length;m<len2;m++){other_jam=row[m];collided=jam.collides_with(other_jam.start_date(),other_jam.end_date());if(collided){break}}if(!collided){row.push(jam);placed=true;break}}if(!placed){rows.push([jam])}}return rows};Calendar.prototype._today=function(){return moment().hours(0).minutes(0).seconds(0).milliseconds(0)};Calendar.prototype.start_date=function(){return this._today().subtract("month",1).toDate()};Calendar.prototype.end_date=function(){return this._today().add("month",2).toDate()};return Calendar}()}).call(this);(function(){I.JamsPage=function(){function JamsPage(el,jams){this.el=$(el);I.format_dates(this.el);this.jams=new J.Jams(jams);this.calendar=new J.Calendar(this.el.find(".jam_calendar"),this.jams)}return JamsPage}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.AddGameLightbox=function(superClass){extend(AddGameLightbox,superClass);function AddGameLightbox(){return AddGameLightbox.__super__.constructor.apply(this,arguments)}AddGameLightbox.prototype.init=function(intent){var form;this.el.toggleClass("intent_join",intent==="join").toggleClass("intent_submit",intent==="submit");form=this.el.find("form");if(!form.length){return}new I.AddGameToJamForm(form,{remote_submit:true,on_submit:function(_this){return function(){return _this.el.addClass("submitted")}}(this)});return this.el.on("click",".see_entries_btn",function(_this){return function(){return setTimeout(function(){return window.location.reload()},100)}}(this))};return AddGameLightbox}(I.Lightbox);I.JamBase=function(){function JamBase(){this.setup_buttons=bind(this.setup_buttons,this)}JamBase.prototype.setup_buttons=function(){this.el.remote_link(function(res){if(res.redirect_to){return window.location=res.redirect_to}});return this.el.dispatch("click",{join_jam_btn:function(_this){return function(btn){if(!I.current_user){I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"join")}return"continue"}}(this),add_game_btn:function(_this){return function(btn){return I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"submit")}}(this),unsubmit_btn:function(_this){return function(btn){var url;url=btn.attr("href");return $.post(url,I.with_csrf({redirect:true}),function(res){return window.location=res.redirect_to})}}(this)})};return JamBase}();I.SaltwJam=function(superClass){extend(SaltwJam,superClass);SaltwJam.prototype.start_date=new Date(Date.UTC(2013,8,13,23));SaltwJam.prototype.end_date=new Date(Date.UTC(2013,8,22,23));function SaltwJam(el){this.setup_countdown=bind(this.setup_countdown,this);this.el=$(el);new I.GameGrid(this.el.find(".game_grid_widget"),{selector:".saltw_jam_page .game_cell .game_thumb"});this.setup_countdown();this.setup_buttons()}SaltwJam.prototype.setup_countdown=function(){var now;now=new Date;if(now<this.start_date){return this.el.addClass("before_start")}else if(now>this.end_date){return this.el.addClass("after_end")}else{return this.el.addClass("during_jam")}};return SaltwJam}(I.JamBase);I.SaltwWinter2013Jam=function(superClass){extend(SaltwWinter2013Jam,superClass);function SaltwWinter2013Jam(){return SaltwWinter2013Jam.__super__.constructor.apply(this,arguments)}SaltwWinter2013Jam.prototype.start_date=new Date(Date.UTC(2013,11,20,23));SaltwWinter2013Jam.prototype.end_date=new Date(Date.UTC(2014,0,0,0));return SaltwWinter2013Jam}(I.SaltwJam);I.ViewJam=function(superClass){extend(ViewJam,superClass);function ViewJam(el,jam){this.jam=jam;this.setup_filters=bind(this.setup_filters,this);this.setup_grid=bind(this.setup_grid,this);this.setup_countdown=bind(this.setup_countdown,this);this.setup_admin=bind(this.setup_admin,this);this.el=$(el);this.setup_buttons();this.setup_grid();this.setup_countdown();this.setup_admin();this.setup_filters();I.format_dates(this.el);I.setup_grid_referrers(this.el,function(_this){return function(){return"jam:"+_this.jam.id}}(this));I.deferred_links(this.el,"a[data-label]")}ViewJam.prototype.setup_admin=function(){return new I.JamAdmin($(document.body),this.jam)};ViewJam.prototype.setup_countdown=function(){var count_to,countdown,end_date,now,start_date,voting_end_date;countdown=this.el.find(".countdown");if(!countdown.length){return}if(countdown.is(":empty")){countdown.html(this.el.find(".jam_content").data("countdown_template"))}start_date=moment.utc(this.jam.start_date).toDate();end_date=moment.utc(this.jam.end_date).toDate();if(this.jam.voting_end_date){voting_end_date=moment.utc(this.jam.voting_end_date).toDate()}now=new Date;count_to=now<start_date?start_date:now<end_date?end_date:voting_end_date&&now<voting_end_date?voting_end_date:void 0;if(count_to){return new I.Countdown(countdown,moment(count_to))}};ViewJam.prototype.setup_grid=function(){var grid;grid=this.el.find(".browse_game_grid");if(grid.length){this.grid=new I.GameGrid(grid,{selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell"});return this.grid.setup_conversion_tracking("8")}};ViewJam.prototype.setup_filters=function(){var cells,filter_picker,grid,grid_outer;filter_picker=this.el.find(".jam_filter_picker");if(!filter_picker.length){return}grid_outer=filter_picker.closest(".grid_outer");grid=grid_outer.find(".browse_game_grid");cells=grid.find(".game_cell");return filter_picker.dispatch("click",{filter_item:function(_this){return function(btn){var filter,visible_cells;btn.parent().find(".filter_item").removeClass("active");btn.addClass("active");filter=btn.data("filter");visible_cells=filter?cells.hide().filter("."+filter).show():cells.show();_this.grid.refresh_images();return grid_outer.toggleClass("no_visible_games",!visible_cells.length)}}(this)})};return ViewJam}(I.JamBase);I.ViewRawJam=function(superClass){extend(ViewRawJam,superClass);function ViewRawJam(){ViewRawJam.__super__.constructor.apply(this,arguments);this.setup_status_message()}ViewRawJam.prototype.setup_status_message=function(){var status_el;status_el=this.el.find(".jam_status");if(!status_el.length){return}status_el.html(this.jam.status_html);return I.format_dates(status_el)};return ViewRawJam}(I.ViewJam)}).call(this);(function(){var LateSubmitUrlLightbox,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;LateSubmitUrlLightbox=function(superClass){extend(LateSubmitUrlLightbox,superClass);function LateSubmitUrlLightbox(){return LateSubmitUrlLightbox.__super__.constructor.apply(this,arguments)}LateSubmitUrlLightbox.prototype.init=function(data){this.el.find(".recipient").text(data.recipient);return this.el.find(".submit_url_input").val(data.submit_url)};return LateSubmitUrlLightbox}(I.Lightbox);I.ViewJamEditSubmissions=function(){function ViewJamEditSubmissions(el){this.el=$(el);this.setup_late_submit_form();this.el.dispatch("click",{remove_game_btn:function(_this){return function(btn){var jam_game;jam_game=btn.closest(".jam_game");if(jam_game.is(".loading")){return}if(!confirm("Are you sure you want to remove this submission?")){return}jam_game.addClass("loading");return $.post(btn.data("href"),I.with_csrf(),function(res){return jam_game.slideUp(function(){return jam_game.remove()})})}}(this)})}ViewJamEditSubmissions.prototype.setup_late_submit_form=function(){this.late_submit=this.el.find(".late_submit_form");return this.late_submit.remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "));return}_this.late_submit.find(".game_url_input").val("");return I.Lightbox.open_tpl("late_submit_url_lightbox",LateSubmitUrlLightbox,res)}}(this))};return ViewJamEditSubmissions}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.ViewJamEntries=function(){function ViewJamEntries(el,jam){this.jam=jam;this.setup_filters=bind(this.setup_filters,this);this.setup_grid=bind(this.setup_grid,this);this.el=$(el);this.setup_grid();this.setup_filters();I.setup_grid_referrers(this.el,function(_this){return function(){return"jam:"+_this.jam.id}}(this));I.deferred_links(this.el,"a[data-label]")}ViewJamEntries.prototype.setup_grid=function(){var grid;grid=this.el.find(".browse_game_grid");if(grid.length){this.grid=new I.GameGrid(grid,{selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell"});return this.grid.setup_conversion_tracking("8")}};ViewJamEntries.prototype.setup_filters=function(){var cells,filter_picker,grid,grid_outer;filter_picker=this.el.find(".jam_filter_picker");if(!filter_picker.length){return}grid_outer=this.el.find(".grid_outer");grid=grid_outer.find(".browse_game_grid");cells=grid.find(".game_cell");return filter_picker.dispatch("click",{tab:function(_this){return function(btn){var filter,visible_cells;btn.parent().find(".tab").removeClass("active");btn.addClass("active");filter=btn.data("filter");visible_cells=filter?cells.hide().filter("."+filter).show():cells.show();_this.grid.refresh_images();return grid_outer.toggleClass("no_visible_games",!visible_cells.length)}}(this)})};return ViewJamEntries}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.ViewJamPlain=function(){function ViewJamPlain(el,jam){this.jam=jam;this.setup_grid=bind(this.setup_grid,this);this.setup_countdown=bind(this.setup_countdown,this);this.el=$(el);this.setup_countdown();this.setup_grid();I.has_follow_button(this.el);I.format_dates(this.el);this.el.remote_link(function(res){if(res.redirect_to){return window.location=res.redirect_to}});this.el.dispatch("click",{join_jam_btn:function(_this){return function(btn){if(!I.current_user){I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"join");return}return"continue"}}(this),add_game_btn:function(_this){return function(btn){return I.Lightbox.open_tpl("add_game_to_jam_lightbox",I.AddGameLightbox,"submit")}}(this)})}ViewJamPlain.prototype.setup_countdown=function(){var count_to,countdown,end_date,now,start_date,voting_end_date;countdown=this.el.find(".countdown");if(!countdown.length){return}start_date=moment.utc(this.jam.start_date).toDate();end_date=moment.utc(this.jam.end_date).toDate();if(this.jam.voting_end_date){voting_end_date=moment.utc(this.jam.voting_end_date).toDate()}now=new Date;count_to=now<start_date?start_date:now<end_date?end_date:voting_end_date&&now<voting_end_date?voting_end_date:void 0;if(count_to){return new I.Countdown(countdown,moment(count_to),{max_blocks:3})}};ViewJamPlain.prototype.setup_grid=function(){var grid;grid=this.el.find(".browse_game_grid");if(grid.length){return this.grid=new I.GameGrid(grid,{selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell"})}};return ViewJamPlain}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.ViewJamRateGame=function(){function ViewJamRateGame(el,game){var input;this.game=game;this.setup_comments=bind(this.setup_comments,this);this.el=$(el);this.setup_ratings();this.setup_downloads();this.setup_header();this.setup_comments();I.format_dates(this.el);input=this.el.find(".judge_feedback_input");if(input.exists()){I.redactor(input,{minHeight:100,source:false})}this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)})}ViewJamRateGame.prototype.setup_comments=function(){var comment_list,input;input=this.el.find(".comment_input");if(input.length){I.redactor(input,{minHeight:100,source:false})}comment_list=this.el.find(".jam_comment_list");return comment_list.dispatch("click",{delete_comment_btn:function(_this){return function(btn){confirm("Are you sure you want to delete this comment?");return $.post(btn.data("href"),I.with_csrf(),function(res){if(res.errors){alert(res.errors.join);return}return btn.closest(".jam_comment").slideUp()})}}(this)})};ViewJamRateGame.prototype.setup_ratings=function(){var rate_btn,star,star_pickers,update_rate_btn;star_pickers=function(){var i,len,ref,results;ref=this.el.find(".star_picker");results=[];for(i=0,len=ref.length;i<len;i++){star=ref[i];results.push(new I.StarPicker(star))}return results}.call(this);rate_btn=this.el.find(".rate_btn");update_rate_btn=function(enabled){var i,len,picker;enabled=true;for(i=0,len=star_pickers.length;i<len;i++){picker=star_pickers[i];if(!picker.el.is(".has_rating")){enabled=false;break}}return rate_btn.toggleClass("disabled",!enabled).prop("disabled",!enabled)};update_rate_btn();this.el.on("i:pick_star",update_rate_btn);return this.el.find(".criteria_rater_form").remote_submit(function(res){if(res.flash){I.flash(res.flash)}if(res.errors){return I.flash("error:"+res.errors[0])}})};ViewJamRateGame.prototype.setup_downloads=function(){var file_size,i,len,ref;ref=this.el.find(".file_size_value");for(i=0,len=ref.length;i<len;i++){file_size=ref[i];file_size=$(file_size);file_size.html(_.str.formatBytes(parseInt(file_size.html())))}return this.el.dispatch("click",{download_btn:function(_this){return function(btn){I.event("jam_game_download","download",""+_this.game.id);I.ConversionTracker.download("1:"+_this.game.id);I.ConversionTracker.flush_now();return $.ajax({url:"/game/download/"+_this.game.id+"/file/"+btn.data("upload_id")+"?after_download_lightbox=true",type:"post",data:I.with_csrf(),success:function(res){var err;if(res.errors){err=res.errors.join(", ");I.event("jam_game_download","error",err);alert(err);return}if(res.lightbox){I.Lightbox.open(res.lightbox,I.AfterDownloadLightbox,_this.game,{page_name:"jam_rate_game"})}return I.start_download(res)}})}}(this)})};ViewJamRateGame.prototype.setup_header=function(){return this.el.dispatch("click",{remove_submission_btn:function(_this){return function(btn){if(btn.is(".loading")){return}if(!confirm("Are you sure you want to remove this submission?")){return}btn.addClass("loading");return $.post(btn.data("href"),I.with_csrf({redirect:true}),function(res){return window.location=res.redirect_to})}}(this)})};return ViewJamRateGame}()}).call(this);(function(){I.ViewJamResults=function(){function ViewJamResults(el){this.el=$(el);I.format_dates(this.el)}return ViewJamResults}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.ViewJamScreenshots=function(superClass){extend(ViewJamScreenshots,superClass);function ViewJamScreenshots(el){ViewJamScreenshots.__super__.constructor.apply(this,arguments);this.grid=new I.GameGrid(this.el.find(".screenshot_grid_widget"),{selector:".screenshot_grid_widget .game_screenshot_cell"})}ViewJamScreenshots.prototype.current_page=1;ViewJamScreenshots.prototype.get_next_page=function(){this.current_page+=1;this.el.addClass("loading");return $.get("",{page:this.current_page,format:"json"},function(_this){return function(res){_this.el.removeClass("loading");if(res.num_items>0){return _this.grid.add_image_loading($(res.content).appendTo(_this.grid.el).hide().fadeIn())}else{return _this.remove_loader()}}}(this))};return ViewJamScreenshots}(I.InfiniteScroll)}).call(this);(function(){var is_different,hasProp={}.hasOwnProperty,slice=[].slice;if(window.R){return}is_different=function(a,b){var key;for(key in a){if(!hasProp.call(a,key))continue;if(a[key]!==b[key]){return true}}for(key in b){if(!hasProp.call(b,key))continue;if(!(key in a)){return true}}return false};window.R=function(name,data,p,prefix){var cl,class_name;if(p==null){p=R}if(prefix==null){prefix=""}data.trigger=function(){var node;node=$(ReactDOM.findDOMNode(this));R.trigger.apply(R,[node].concat(slice.call(arguments)));return void 0};data.dispatch=function(){var node;node=$(ReactDOM.findDOMNode(this));R.dispatch.apply(R,[node].concat(slice.call(arguments)));return void 0};data.container=function(){return $(ReactDOM.findDOMNode(this))};data.extend_props=function(){var more;more=1<=arguments.length?slice.call(arguments,0):[];return $.extend.apply($,[{},this.props].concat(slice.call(more)))};class_name=_.once(function(){return(""+prefix+name).replace(/[A-Z]/g,"_$&").replace(/\./g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").toLowerCase()+"_widget"});data.enclosing_class_name=class_name;data.enclose=function(){var args,component,props;props=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];component=props.component||"div";delete props.component;return React.createElement.apply(React,[component,$.extend({},props,{className:classNames(class_name(),props.className)})].concat(slice.call(args)))};data.displayName=""+prefix+name;if(data.pure){data.shouldComponentUpdate=function(nextProps,nextState){return is_different(this.props,nextProps)||is_different(this.state,nextState)}}cl=React.createClass(data);p[name]=React.createFactory(cl);return p[name]._class=cl};R.scope_event_name=function(name){return"itch:"+name};R.trigger=function(){var args,name,node;node=arguments[0],name=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];return node.trigger(R.scope_event_name(name),slice.call(args))};R.dispatch=function(node,prefix,event_table){var event_name,fn,results;if(typeof prefix==="object"){event_table=prefix;prefix=false}results=[];for(event_name in event_table){if(!hasProp.call(event_table,event_name))continue;fn=event_table[event_name];if(prefix){event_name=prefix+":"+event_name}results.push(node.on(R.scope_event_name(event_name),fn))}return results};R.component=function(){return R.apply(null,arguments)};R["package"]=function(_this){return function(prefix){var p;p=R[prefix]||(R[prefix]=function(name,data){data.Package=p;return R.component(name,data,p,prefix+".")});p.component=function(){return p.apply(null,arguments)};return p}}(this)}).call(this);(function(){var P,a,br,button,c,code,div,em,fieldset,form,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,ref,section,select,span,strong,textarea,types,ul,slice=[].slice;if(!this.React){return}ref=React.DOM,div=ref.div,span=ref.span,a=ref.a,br=ref.br,p=ref.p,ol=ref.ol,ul=ref.ul,li=ref.li,strong=ref.strong,em=ref.em,img=ref.img,form=ref.form,label=ref.label,input=ref.input,textarea=ref.textarea,button=ref.button,iframe=ref.iframe,h1=ref.h1,h2=ref.h2,h3=ref.h3,h4=ref.h4,h5=ref.h5,h6=ref.h6,pre=ref.pre,code=ref.code,select=ref.select,option=ref.option,section=ref.section,optgroup=ref.optgroup,fieldset=ref.fieldset,legend=ref.legend;if(R.Redactor){return}c=function(_this){return function(){return R.component.apply(R,arguments)}}(this);types=React.PropTypes;c("Redactor",{componentDidMount:function(){return I.redactor($(ReactDOM.findDOMNode(this)),{minHeight:80,source:false})},render:function(){return textarea({name:this.props.name,value:this.props.value,defaultValue:this.props.defaultValue})}});c("CSRF",{pure:true,render:function(){return input({type:"hidden",name:"csrf_token",value:$("meta[name=csrf_token]").attr("value")})}});P=R["package"]("Forms");P("TextInputRow",{pure:true,propTypes:{title:types.string,sub:types.any,name:types.string.isRequired,value:types.any},componentDidMount:function(){var valid_slug_chars;if(this.props.money_input){if(!this.props.currency){throw new Error("missing currency")}I.money_input(this.refs.input,{currency:this.props.currency})}if(this.props.slug_input){I.slug_input($(this.refs.input))}if(this.props.integer_input){valid_slug_chars=/[0-9]/g;return $(this.refs.input).on("keypress",function(_this){return function(e){var char;if(e.keyCode>=32){char=String.fromCharCode(e.keyCode);if(!char.match(valid_slug_chars)){return false}}}}(this))}},render:function(){var inside;inside=[div({className:"label"},this.props.title,this.props.sub?span({className:"sub"},"  ",this.props.sub):void 0),input({type:"text",name:this.props.name,ref:"input",value:this.props.value,defaultValue:this.props.defaultValue,onChange:this.props.onChange,onKeyUp:this.props.onKeyUp,className:classNames({has_error:this.props.has_error}),required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern}),this.props.error_message?p({className:"input_error"},this.props.error_message):void 0];if(!this.props.multi){inside=label({children:inside})}return div({className:"input_row",children:inside})}});P("SimpleSelect",{propTypes:{options:types.array.isRequired,name:types.string},getInitialState:function(){return{}},render:function(){var children,current,current_group,push_group,render_current_option;current=this.current_option();render_current_option=this.props.render_current_option;render_current_option||(render_current_option=function(_this){return function(current){return current.short_name||current.name}}(this));children=[];current_group=null;push_group=function(){if(!current_group){return}children.push(optgroup.apply(null,[{label:current_group.label}].concat(slice.call(current_group.children))));return current_group=null};this.props.options.map(function(_this){return function(o,idx){var opt;opt=option({key:""+idx,value:o.value},o.name);if(o.group){if((current_group!=null?current_group.label:void 0)!==o.group){push_group()}current_group||(current_group={label:o.group,children:[]});return current_group.children.push(opt)}else{push_group();return children.push(opt)}}}(this));push_group();return this.enclose({className:classNames({focused:this.state.focused,disabled:this.props.disabled}),children:[div({className:"selected_option"},span({className:"selected_option_name"},render_current_option(current)),span({className:"icon icon-triangle-down"})),select({disabled:this.props.disabled,value:current.value,name:this.props.name,onFocus:function(_this){return function(e){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(e){return _this.setState({focused:false})}}(this),onChange:this.on_change,children:children})]})},on_change:function(e){var value;value=e.target.value;if(this.props.onChange){if(value===this.props.value){return}return this.props.onChange(value)}else{if(value===this.state.value){return}return this.setState({value:value})}},find_option:function(value){var i,len,opt,ref1;ref1=this.props.options;for(i=0,len=ref1.length;i<len;i++){opt=ref1[i];if(opt.value===value){return opt}}},current_option:function(){var current,search_value;search_value=this.props.value||this.state.value;current=search_value!=null?this.find_option(search_value):void 0;return current||this.props.options[0]}});P("Select",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},componentDidMount:function(){var el,opts;if(!this.props.selectize){return}opts=this.props.selectize===true?{}:this.props.selectize;el=$(this.refs.input);el.selectize(opts);if(this.props.onChange){return el.on("change",function(_this){return function(e){return _this.props.onChange(e)}}(this))}},render:function(){return select({ref:"input",name:this.props.name,onChange:this.props.onChange,value:this.props.value,defaultValue:this.props.defaultValue,children:this.props.options.map(function(_this){return function(arg){var label,value;value=arg[0],label=arg[1];return option({value:value},label||value)}}(this))})}});P("RadioButtons",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},getValue:function(){var i,len,name,ref1,ref2,value;ref1=this.container().find("input").serializeArray();for(i=0,len=ref1.length;i<len;i++){ref2=ref1[i],name=ref2.name,value=ref2.value;return value}},render:function(){return ul({className:"radio_list",children:this.props.options.map(function(_this){return function(arg){var input_label,more_opts,sub,value;value=arg[0],input_label=arg[1],sub=arg[2],more_opts=arg[3];return li({className:classNames({disabled:more_opts!=null?more_opts.disabled:void 0})},label({children:[input($.extend({type:"radio",name:_this.props.name,value:value,defaultChecked:_this.props.defaultValue?value===_this.props.defaultValue:void 0,checked:_this.props.value!=null?value===_this.props.value:void 0,onChange:_this.props.onChange},more_opts)),span({className:"radio_label"},input_label),sub?span({className:"sub",children:["  ",sub]}):void 0]}))}}(this))})}});P("ColorInput",{propTypes:{name:types.string,value:types.any,defaultValue:types.any,allow_empty:types.bool},palette:["#193D3F","#3F2832","#743F39","#9E2835","#B86F50","#327345","#E53B44","#4F6781","#0484D1","#FB922B","#AFBFD2","#63C64D","#E4A672","#2CE8F4","#FFE762"],componentDidMount:function(){var base;(base=R.Forms.ColorInput).active_inputs||(base.active_inputs=[]);R.Forms.ColorInput.active_inputs.push(this);if(!$._farbtastic){throw new Error("Need farb to create color picker")}this.farb=new $._farbtastic($());if(c=this.props.defaultValue){this.farb.setColor(c)}return this.refresh_preview=_.debounce(function(){return this.set_color_from_input(false)},500)},componentDidUpdate:function(prev_props,prev_state){var current_value,new_value,popup_farb;current_value=prev_props.value||"";new_value=this.props.value||"";if(current_value!==new_value){if(c=this.set_color(new_value)){this.refs.input.value=c}}if(!prev_state.open&&this.state.open){popup_farb=$.farbtastic($(this.refs.farb),function(_this){return function(color){if(c=_this.set_color(color)){return _this.refs.input.value=c}}}(this));if(this.state.last_value){popup_farb.setColor(this.state.last_value)}return this.setState({popup_farb:popup_farb})}},getInitialState:function(){return{open:false,last_value:this.props.value||this.props.defaultValue||""}},set_color_from_input:function(){var color,f;if(!this.refs.input){return}color=this.set_color.apply(this,[this.refs.input.value].concat(slice.call(arguments)));if(!color){return}if(color!==this.refs.input.value){this.refs.input.value=color}if(f=this.state.popup_farb){return f.setColor(color)}},set_color:function(color,fix_input){var base,base1;if(fix_input==null){fix_input=true}color||(color="");if(this.props.allow_empty&&color===""){this.farb.setColor("#ffffff");this.setState({last_value:""});if(fix_input){this.refs.input.value=""}if(typeof(base=this.props).onChange==="function"){base.onChange("")}return""}if(!color.match(/^#/)){color="#"+color}this.farb.setColor(color);if(color===this.farb.color){this.setState({last_value:color});if(typeof(base1=this.props).onChange==="function"){base1.onChange(color)}return color}else{if(fix_input){this.refs.input.value=this.state.last_value||""}return false}},open:function(){if(this.state.open){return}this.setState({open:true,on_left:this.popup_on_left()});this.click_outside_handler||(this.click_outside_handler=function(_this){return function(e){var self;self=ReactDOM.findDOMNode(_this);if($(e.target).closest(self).length){return}return _this.close()}}(this));return $(document.body).on("mousedown",this.click_outside_handler)},componentWillUnmount:function(){if(this.click_outside_handler){return $(document.body).off("mousedown",this.click_outside_handler)}},close:function(){if(!this.state.open){return}this.setState({open:false,popup_farb:void 0});return $("document.body").off("mousedown",this.click_outside_handler)},popup_on_left:function(){var el,popup_right;el=$(ReactDOM.findDOMNode(this));popup_right=el.offset().left+el.width()+250;return popup_right>$(window).width()+$(window).scrollLeft()},render_color_popout:function(){var palette;palette=this.props.palette||this.palette;return div({className:"color_popout",children:[this.props.allow_empty&&this.state.last_value?button({type:"button",className:"clear_color_btn",onClick:function(_this){return function(){return _this.set_color("")}}(this)},"Clear"):void 0,div({className:"farb_drop",ref:"farb"}),palette?div({className:"palette_options"},palette.map(function(_this){return function(color){return button({key:color,type:"button",style:{backgroundColor:color},onClick:function(e){return _this.set_color(color)}},color)}}(this))):void 0]})},render:function(){var current_color;current_color=this.state.last_value||"#ffffff";return this.enclose({className:classNames(this.props.className,{picker_open:this.state.open,picker_left:this.state.on_left}),children:[input({ref:"input",type:"text",className:"color_text_input",name:this.props.name,defaultValue:this.props.value||this.props.defaultValue,placeholder:this.props.defaultValue||"Color",onBlur:this.set_color_from_input,onFocus:this.open,onKeyDown:function(_this){return function(e){switch(e.keyCode){case 9:_this.close();break;case 13:_this.set_color_from_input();e.preventDefault()}return _this.refresh_preview()}}(this)}),div({className:"color_swatch",onClick:this.open,style:{backgroundColor:current_color}}),this.state.open?this.render_color_popout():void 0]})}});P("Slider",{propTypes:{min:types.number,max:types.number,value:types.number,onChange:types.func,disabled:types.bool},getInitialState:function(){return{}},on_change:function(value){value=Math.round(value);if(this.props.onChange){if(this.props.value===value){return}return this.props.onChange(value)}else{if(this.state.value===value){return}return this.setState({value:value})}},start_drag:function(start_x,start_y){var move_listener,start_value,up_listener,width;if(this.props.disabled){return}width=this.refs.track.clientWidth;start_value=this.current_value();this.setState({dragging:true});move_listener=function(_this){return function(e){var dx,new_value,x,y;if(e.buttons===0){up_listener();return}x=e.pageX;y=e.pageX;dx=x-start_x;new_value=dx/width*(_this.props.max-_this.props.min)+start_value;new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this);up_listener=function(_this){return function(e){_this.setState({dragging:false});document.body.removeEventListener("mousemove",move_listener);document.body.removeEventListener("mouseup",up_listener);return delete _this.up_listener}}(this);document.body.addEventListener("mousemove",move_listener);document.body.addEventListener("mouseup",up_listener);return this.up_listener=up_listener},current_value:function(){if("value"in this.state){return this.state.value||this.props.min}else{return this.props.value||this.props.min}},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener){return this.up_listener()}},render:function(){var offset_style;offset_style={left:this.percent()*100+"%"};return this.enclose({className:classNames("slider_input",{disabled:this.props.disabled}),onClick:function(_this){return function(e){var new_value,rect;if(e.target===_this.refs.slider_nub){return}rect=_this.refs.track.getBoundingClientRect();p=Math.min(rect.width,Math.max(0,e.pageX-rect.left))/rect.width;new_value=_this.props.min+p*(_this.props.max-_this.props.min);new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this),children:[this.props.name?input({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,div({ref:"track",className:"slider_track"},div({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?div({style:offset_style,className:"value_tooltip"},this.current_value()):void 0,button({type:"button",ref:"slider_nub",className:"slider_nub",onFocus:function(_this){return function(){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(){return _this.setState({focused:false})}}(this),onMouseDown:function(_this){return function(e){return _this.start_drag(e.pageX,e.pageY)}}(this),onKeyDown:function(_this){return function(e){switch(e.keyCode){case 37:_this.on_change(Math.max(_this.props.min,_this.current_value()-1));break;case 39:_this.on_change(Math.min(_this.props.max,_this.current_value()+1));break;default:return}return e.preventDefault()}}(this),style:offset_style}))]})}})}).call(this);(function(){var P,a,br,button,code,div,em,fieldset,form,h1,h2,h3,h4,h5,h6,id,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,ref,section,select,span,strong,textarea,types,ul,slice=[].slice;if(!this.React){return}ref=React.DOM,div=ref.div,span=ref.span,a=ref.a,br=ref.br,p=ref.p,ol=ref.ol,ul=ref.ul,li=ref.li,strong=ref.strong,em=ref.em,img=ref.img,form=ref.form,label=ref.label,input=ref.input,textarea=ref.textarea,button=ref.button,iframe=ref.iframe,h1=ref.h1,h2=ref.h2,h3=ref.h3,h4=ref.h4,h5=ref.h5,h6=ref.h6,pre=ref.pre,code=ref.code,select=ref.select,option=ref.option,section=ref.section,optgroup=ref.optgroup,fieldset=ref.fieldset,legend=ref.legend;P=R["package"]("JamEdit");types=React.PropTypes;id=0;P("EditCriteria",{propTypes:{criteria:types.array,can_edit:types.bool},getInitialState:function(){return{criteria:slice.call(this.props.criteria)}},componentDidMount:function(){var move;move=function(_this){return function(item,dir){var current_idx,idx,items,other;current_idx=null;items=function(){var i,len,ref1,results;ref1=this.state.criteria;results=[];for(idx=i=0,len=ref1.length;i<len;idx=++i){other=ref1[idx];if(other===item){current_idx=idx;continue}results.push(other)}return results}.call(_this);items.splice(current_idx+dir,0,item);return items}}(this);return this.dispatch({new_crit:function(_this){return function(){var key;key="auto-"+id++;_this.last_added={key:key};return _this.setState({criteria:_this.state.criteria.concat([_this.last_added])},function(){if(_this.last_created_input!=null){_this.last_created_input.focus();return delete _this.last_created_input}})}}(this),remove:function(_this){return function(e,crit){var c;return _this.setState({criteria:function(){var i,len,ref1,results;ref1=this.state.criteria;results=[];for(i=0,len=ref1.length;i<len;i++){c=ref1[i];if(c!==crit){results.push(c)}}return results}.call(_this)})}}(this),move_up:function(_this){return function(e,crit){return _this.setState({criteria:move(crit,-1)})}}(this),move_down:function(_this){return function(e,crit){return _this.setState({criteria:move(crit,1)})}}(this),update_crit:function(_this){return function(e,crit,changes){return _this.setState({criteria:_this.state.criteria.map(function(other){if(other===crit){return $.extend({},crit,changes)}else{return other}})})}}(this),set_primary:function(_this){return function(e,crit){return _this.setState({criteria:_this.state.criteria.map(function(other){return $.extend({},other,{primary:other===crit})})})}}(this)})},render:function(){return this.enclose({children:[this.props.can_edit?input({type:"hidden",name:"jam[update_criteria]",value:"1"}):void 0,this.render_criteria(),this.props.can_edit&&!this.state.criteria.length?p({className:"warning"},"You must add at least one criteria for voting to take place."):void 0,this.props.can_edit?div({className:"button_row"},button({type:"button",className:"button add_criteria_btn",onClick:function(_this){return function(e){return _this.trigger("new_crit")}}(this)},"Add new criteria")):p({className:"criteria_blocked"},"The submission end date has elapsed and you can no longer edit criteria")]})},render_criteria:function(){if(!this.state.criteria.length){return}return div({className:"criteria_list",children:this.state.criteria.map(function(_this){return function(crit,pos){return P.JamCriteriaRow({criteria:crit,pos:pos,is_first:pos===0,is_last:pos===_this.state.criteria.length-1,can_edit:_this.props.can_edit,show_primary_toggle:_this.state.criteria.length>1,ref:function(c){if(c){return _this.last_created_input=c.refs.input}}})}}(this))})}});P("JamCriteriaRow",{pure:true,render:function(){var crit,criteria_settings,input_name;crit=this.props.criteria;input_name=function(_this){return function(name){return"jam[criteria]["+(_this.props.pos+1)+"]["+name+"]"}}(this);criteria_settings=this.props.can_edit?div({className:"sub_criteria_settings",children:[this.props.show_primary_toggle?label({className:"primary_toggle",children:[input({type:"checkbox",name:input_name("primary"),checked:crit.primary||false,onChange:function(_this){return function(e){return _this.trigger("set_primary",e.target.checked&&crit||false)}}(this)}),"Primary"]}):void 0,crit.edit_url?a({href:crit.edit_url,target:"_blank"},"Edit results..."):void 0,div({className:"link_settings"},!this.props.is_first?a({href:"javascript:void(0)",onClick:function(_this){return function(e){return _this.trigger("move_up",crit)}}(this)},"Move up"):void 0," ",!this.props.is_last?a({href:"javascript:void(0)",onClick:function(_this){return function(e){return _this.trigger("move_down",crit)}}(this)},"Move down"):void 0," ",a({href:"javascript:void(0)",className:"remove_crit_btn",onClick:function(_this){return function(e){return _this.trigger("remove",crit)}}(this)},"Remove"))]}):crit.primary||crit.edit_url?div({className:"sub_criteria_settings"},crit.primary?strong({},"Primary"):void 0," ",crit.edit_url?a({href:crit.edit_url,target:"_blank"},"Edit results..."):void 0):void 0;return div({key:crit.id||crit.key,className:"criteria_row",children:[input({disabled:!this.props.can_edit,type:"hidden",name:input_name("id"),value:crit.id||""}),div({className:"primary_criteria_settings"},input({disabled:!this.props.can_edit,ref:"input",placeholder:"How should the entry be judged?",type:"text",name:input_name("name"),value:crit.name||"",className:"criteria_input",onChange:function(_this){return function(e){return _this.trigger("update_crit",crit,{name:e.target.value})}}(this)}),R.Forms.SimpleSelect({disabled:!this.props.can_edit,name:input_name("type"),value:crit.type||"default",onChange:function(_this){return function(type){return _this.trigger("update_crit",crit,{type:type})}}(this),options:[{name:"Voted on",value:"default"},{name:"Manually ranked",value:"manual_order"}]})),criteria_settings]})}})}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.Grapher=function(){var format_number;Grapher.format_number=format_number=function(num){if(num>1e7){return Math.floor(num/1e6)+"m"}else if(num>=1e6){return Math.floor(num/1e5)/10+"m"}else if(num>1e4){return Math.floor(num/1e3)+"k"}else if(num>=1e3){return Math.floor(num/100)/10+"k"}else{return""+num}};Grapher.prototype.chart_svg_class="chart";Grapher.prototype.margin_left=40;Grapher.prototype.margin_bottom=30;Grapher.prototype.margin_right=30;Grapher.prototype.margin_top=20;Grapher.prototype.dot_hitbox_w=30;Grapher.prototype.dot_hitbox_h=120;Grapher.prototype.axis_spacing=8;Grapher.prototype.axis_graph_padding=10;Grapher.prototype.popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';Grapher.prototype.default_opts={label:"Count",y_axis_padding:1.3,min_y:10,x_ticks:10,fit_dots:false};function Grapher(el,data1,opts){this.data=data1;this.increment_date=bind(this.increment_date,this);this.list_range=bind(this.list_range,this);this.get_range=bind(this.get_range,this);this.format_y_axis=bind(this.format_y_axis,this);this.get_y_scaled=bind(this.get_y_scaled,this);this.get_x_scaled=bind(this.get_x_scaled,this);this.get_y=bind(this.get_y,this);this.get_x=bind(this.get_x,this);this.popup_date=bind(this.popup_date,this);this.axis_offsets=bind(this.axis_offsets,this);this.el=$(el);this.opts=$.extend({},this.default_opts,opts);this.draw();this.setup_popups()}Grapher.prototype.popup_position=function(hitbox){var point_offset,x,y;point_offset=hitbox.prev("circle").position();x=Math.floor(point_offset.left);y=Math.floor(point_offset.top);return[x,y]};Grapher.prototype.get_template=function(name){var base;if(name==null){name="poup_template"}this._templates||(this._templates={});(base=this._templates)[name]||(base[name]=_.template(this[name]));return this._templates[name]};Grapher.prototype.setup_popups=function(){var current_popup,remove_popup,toggle_popup;current_popup=null;remove_popup=function(popup){if(!popup){return}return popup.stop(true,true).remove()};toggle_popup=_.debounce(function(_this){return function(state,hitbox){var h,pad,popup,ref,template,w,x,y;hitbox=$(hitbox);if(!hitbox.data("popup")){return}switch(state){case"show":template=_this.get_template(hitbox.data("popup_template")||"popup_template");popup=hitbox.data("popup_el");if(current_popup!=null?current_popup.is(popup):void 0){return}remove_popup(current_popup);if(!popup){popup=$(template(hitbox.data("popup")));hitbox.data("popup_el",popup)}current_popup=popup;current_popup.appendTo(_this.el).hide().fadeIn("fast");ref=_this.popup_position(hitbox),x=ref[0],y=ref[1];pad=5;w=current_popup.outerWidth();h=current_popup.outerHeight();current_popup.css({left:x-w-pad+"px",top:y-h-pad+"px"});return typeof _this.on_show_popup==="function"?_this.on_show_popup(current_popup,hitbox):void 0;case"hide":remove_popup(current_popup);if(typeof _this.on_hide_popup==="function"){_this.on_hide_popup(current_popup,hitbox)}return current_popup=null}}}(this),30);this.el[0].addEventListener("mouseover",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("show",e.target)}}}(this));return this.el[0].addEventListener("mouseout",function(_this){return function(e){var ref;if((ref=e.target.getAttribute("class"))!=null?ref.match(/\bhitbox\b/):void 0){return toggle_popup("hide",e.target)}}}(this))};Grapher.prototype.draw=function(){var data,x,y;this.w=this.el.width();this.h=this.el.height();this.time_format=d3.time.format("%Y-%m-%d");this.svg=d3.select(this.el[0]).append("svg").attr("class",this.chart_svg_class).attr("width",this.w).attr("height",this.h);data=this.format_data();x=this._x_scale=this.x_scale(data);y=this._y_scale=this.y_scale(data);this.draw_guides(x,y);this.draw_area(data);this.draw_axis(x,y);this.draw_dots(data);return this.draw_label()};Grapher.prototype.guide_x_range=function(x,y){return x.range()};Grapher.prototype.draw_guides=function(x,y){var gx,gy,ref,y_guides;y_guides=this.svg.append("g").attr("class","y_guides");ref=this.guide_x_range(x,y),gx=ref[0],gy=ref[1];y_guides.selectAll("line").data(y.ticks(this.y_ticks())).enter().append("line").attr("x1",gx).attr("y1",y).attr("x2",gy).attr("y2",y);return this.svg.append("g").attr("class","x_guides").selectAll("line").data(x.ticks(this.x_ticks())).enter().append("line").attr("x1",x).attr("y1",y.range()[0]).attr("x2",x).attr("y2",y.range()[1])};Grapher.prototype.axis_offsets=function(){return[0,0]};Grapher.prototype.draw_axis=function(x,y){var left,ox,oy,ref,x_axis,y_axis;y_axis=d3.svg.axis().scale(y).orient("left").tickFormat(this.format_y_axis).ticks(this.y_ticks());left=x.domain()[0];ref=this.axis_offsets(),ox=ref[0],oy=ref[1];this.svg.append("g").attr("transform","translate("+(this._x_scale(left)+ox-this.axis_spacing)+", 0)").attr("class","y_axis axis").call(y_axis);x_axis=d3.svg.axis().scale(x).orient("bottom").ticks(this.x_ticks());return this.svg.append("g").attr("transform","translate(0, "+(y.range()[0]+oy+this.axis_spacing)+")").attr("class","x_axis axis").call(x_axis)};Grapher.prototype.draw_area=function(data){var area;area=d3.svg.area().x(this.get_x_scaled).y1(this.get_y_scaled).y0(this.h-this.margin_bottom);return this.svg.append("g").attr("class","graph").append("path").attr("d",area(data))};Grapher.prototype.draw_label=function(){var label;label=this.svg.append("g").attr("class","label").attr("transform","translate("+this.margin_left+", 10)");label.append("circle").attr("cx",0).attr("cy",-5).attr("r",4);return label.append("text").text(this.opts.label).attr("x",10)};Grapher.prototype.draw_dots=function(data,opts){var hitbox_h,hitbox_w,popups;if(opts==null){opts={}}data=this.filter_dots_data(data);if(this.list_range().length>60){return}popups=this.svg.append("g").attr("class","popups").selectAll("g").data(data).enter().append("g").attr("class","popup_trigger");hitbox_w=this.dot_hitbox_w;hitbox_h=this.dot_hitbox_h;popups.append("circle").attr("class","dot_outline").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",6);popups.append("circle").attr("class","dot").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",4);return popups.append("rect").attr("class","hitbox").attr("transform","translate(-"+hitbox_w/2+", -"+hitbox_h/2+")").attr("x",this.get_x_scaled).attr("y",this.get_y_scaled).attr("width",hitbox_w).attr("height",hitbox_h).attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.popup_label.apply(_this,arguments)})}}(this))};Grapher.prototype.filter_dots_data=function(data){var can_fit,dots_to_fit,i,real_w,subset,take_every;if(this.opts.fit_dots){real_w=this.w-this.margin_left-this.margin_right-this.axis_graph_padding;can_fit=Math.floor(real_w/this.dot_hitbox_w);if(data.length>can_fit){dots_to_fit=Math.floor((real_w-this.dot_hitbox_w*2)/this.dot_hitbox_w);take_every=Math.floor((data.length-2)/dots_to_fit);subset=function(){var j,ref,ref1,results;results=[];for(i=j=1,ref=data.length-2,ref1=take_every;ref1>0?j<=ref:j>=ref;i=j+=ref1){results.push(data[i])}return results}();subset.push(data[data.length-1]);subset.unshift(data[1]);return subset}}return data};Grapher.prototype.popup_label=function(d){var val;val=this.opts.rate?_.str.numberFormat(this.get_y(d),4)+"%":_.str.numberFormat(this.get_y(d));return this.opts.label+": "+val};Grapher.prototype.popup_date=function(d){return d.date};Grapher.prototype.get_x=function(d){return this.time_format.parse(d.date)};Grapher.prototype.get_y=function(d){if(this.opts.rate){return d.count*100}else{return d.count}};Grapher.prototype.get_x_scaled=function(){return this._x_scale(this.get_x.apply(this,arguments))};Grapher.prototype.get_y_scaled=function(){return this._y_scale(this.get_y.apply(this,arguments))};Grapher.prototype.format_y_axis=function(num){if(this.opts.rate){if(num<10&&num!==0){return _.str.numberFormat(num,1)+"%"}else{return _.str.numberFormat(num)+"%"}}else{return I.Grapher.format_number(num)}};Grapher.prototype.x_ticks=function(){return this.opts.x_ticks};Grapher.prototype.y_ticks=function(){if(this.opts.rate){return 5}else{return Math.min(5,this.opts.min_y)}};Grapher.prototype.get_range=function(){var format,left,new_left,offset,out,right,today;if(this.opts.range_left){format=d3.time.format("%Y-%m-%d");out=[format.parse(this.opts.range_left),format.parse(this.opts.range_right)];if(this.opts.interval==="weekly"&&this.data[0]){format=d3.time.format("%Y-%m-%d");left=out[0];new_left=format.parse(this.data[0].date);while(new_left>left){new_left=d3.time.day.offset(new_left,-7)}return[new_left,out[1]]}return out}if(this.opts.num_days){today=d3.time.day(new Date);offset=this.opts.day_offset||0;left=d3.time.day.offset(today,-(this.opts.num_days+offset-1));right=d3.time.day.offset(today,-offset);return[left,right]}throw"Don't know how to calculate range"};Grapher.prototype.map_range=function(fn){var left,ref,results,right,t,val;ref=this.get_range(),left=ref[0],right=ref[1];t=left;results=[];while(t<=right){val=fn(t);t=this.increment_date(t);if(!val){continue}results.push(val)}return results};Grapher.prototype.list_range=function(){var out;out=[];this.map_range(function(d){return out.push(d)});return out};Grapher.prototype.increment_date=function(t){if(this.opts.interval==="weekly"){return d3.time.day.offset(t,7)}else{return d3.time.day.offset(t,1)}};Grapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var formatted;formatted=_this.time_format(t);return counts_by_date[formatted]||{count:0,date:formatted}}}(this))};Grapher.prototype.x_scale=function(data){var left,ref,right;ref=this.get_range(),left=ref[0],right=ref[1];return d3.time.scale().domain([left,right]).rangeRound([this.margin_left+this.axis_graph_padding,this.w-this.margin_right])};Grapher.prototype.y_scale=function(data){var axis_max_y,max,out,out_range,p;max=d3.max(data,this.get_y)||0;p=this.opts.y_axis_padding||1.3;out_range=[this.h-this.margin_bottom,this.margin_top];axis_max_y=this.opts.rate?Math.max(.5,Math.floor(max*10*p)/10):Math.max(this.opts.min_y,Math.floor((max+1)*p));out=d3.scale.linear().domain([0,axis_max_y]);if(this.opts.rate){return out.range(out_range)}else{return out.rangeRound(out_range)}};return Grapher}();I.MoneyGrapher=function(superClass){extend(MoneyGrapher,superClass);function MoneyGrapher(){this.format_y_axis=bind(this.format_y_axis,this);return MoneyGrapher.__super__.constructor.apply(this,arguments)}MoneyGrapher.prototype.format_y_axis=function(num){var dollars;dollars=this.opts.currency==="JPY"?num:num/100;if(dollars>9){Math.floor(dollars)}return(I.currency_symbols[this.opts.currency]||"$")+I.Grapher.format_number(dollars)};MoneyGrapher.prototype.popup_label=function(d){return this.opts.label+": "+I.format_money(d.sum,this.opts.currency)};return MoneyGrapher}(I.Grapher);I.CumulativeGraph=function(superClass){extend(CumulativeGraph,superClass);function CumulativeGraph(){this.get_range=bind(this.get_range,this);this.get_y=bind(this.get_y,this);return CumulativeGraph.__super__.constructor.apply(this,arguments)}CumulativeGraph.prototype.default_opts={label:"Amount",min_y:100,x_ticks:8,fit_dots:true,min_range:7,currency:"USD",y_axis_padding:1.3};CumulativeGraph.prototype.get_y=function(d){return d.sum};CumulativeGraph.prototype.get_range=function(){var first,format,last,range_ago;format=d3.time.format("%Y-%m-%d");first=this.data[0];last=this.data[this.data.length-1];first=format.parse(first.date);last=format.parse(last.date);range_ago=d3.time.day.offset(last,-this.opts.min_range);if(range_ago<first){first=range_ago}return[first,last]};CumulativeGraph.prototype.format_data=function(){var by_date,j,last,len,ref,v;by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];by_date[v.date]=v}last=0;return this.map_range(function(_this){return function(t){var formatted,ref1;formatted=_this.time_format(t);last=((ref1=by_date[formatted])!=null?ref1.sum:void 0)||last;return{sum:last,date:formatted}}}(this))};return CumulativeGraph}(I.MoneyGrapher);I.BarGrapher=function(superClass){extend(BarGrapher,superClass);function BarGrapher(){return BarGrapher.__super__.constructor.apply(this,arguments)}BarGrapher.prototype.x_axis_unit_offset=-.5;BarGrapher.prototype.chart_svg_class="chart bar_chart";BarGrapher.prototype.dot_hitbox_w=20;BarGrapher.prototype.dot_hitbox_h=20;BarGrapher.prototype.axis_offsets=function(){return[-Math.floor(this.bar_width()/2),0]};BarGrapher.prototype.bar_width=function(){var bl,br;bl=this.get_range()[0];br=d3.time.day.offset(bl,1);return this._x_scale(br)-this._x_scale(bl)};BarGrapher.prototype.guide_x_range=function(x,y){var a,b,bw,ref;ref=x.range(),a=ref[0],b=ref[1];bw=this.bar_width();return[a-bw/2,b+bw/2]};BarGrapher.prototype.x_scale=function(data){var available_width,bar_width,bars,bh,d,left,left_date,ref,right,right_date;ref=this.get_range(),left_date=ref[0],right_date=ref[1];left=this.margin_left+this.axis_graph_padding;right=this.w-this.margin_right;available_width=right-left;d=d3.time.scale().domain([left_date,right_date]);bars=d.ticks(d3.time.day,1);bar_width=available_width/bars.length;bh=bar_width/2;return d.rangeRound([left+bh,right-bh])};BarGrapher.prototype.draw_area=function(data){var bar_width,bars,x_centered;bar_width=this.bar_width();x_centered=function(_this){return function(d){var x;x=_this.get_x_scaled(d);return x-(bar_width-5)/2}}(this);return bars=this.svg.append("g").attr("class","bars").selectAll("rect").data(data).enter().append("rect").attr("x",x_centered).attr("y",this.get_y_scaled).attr("width",bar_width-5).attr("height",function(_this){return function(d){return _this._y_scale(0)-_this.get_y_scaled(d)}}(this))};return BarGrapher}(I.Grapher);I.StackedBarGrapher=function(superClass){extend(StackedBarGrapher,superClass);StackedBarGrapher.prototype.bar_popup_template='<div class="graph_popup">\n  <div class="popup_date">{{ date }}</div>\n  <div class="popup_group">{{ group }}</div>\n  <div class="popup_label">{{ label }}</div>\n</div>';function StackedBarGrapher(){this.on_hide_popup=bind(this.on_hide_popup,this);this.on_show_popup=bind(this.on_show_popup,this);this.popup_group=bind(this.popup_group,this);StackedBarGrapher.__super__.constructor.apply(this,arguments);this.el.on("click","[data-game_id]",function(_this){return function(e){var id,url;if(!_this.opts.group_url){return}id=$(e.target).data("game_id");url=_this.opts.group_url({game_id:id});if(!url){return}return window.location=url}}(this))}StackedBarGrapher.prototype.secondary_field=function(){return this.opts.secondary_field||"game_id"};StackedBarGrapher.prototype.get_y=function(d){return d.max};StackedBarGrapher.prototype.popup_group=function(d){return d[this.secondary_field()]};StackedBarGrapher.prototype.bar_popup_label=function(d){var val;val=_.str.numberFormat(d.max-d.min);return this.opts.label+": "+val};StackedBarGrapher.prototype.format_data=function(){var counts_by_date,j,len,ref,v;counts_by_date={};ref=this.data;for(j=0,len=ref.length;j<len;j++){v=ref[j];counts_by_date[v.date]=v}return this.map_range(function(_this){return function(t){var count,formatted,idx,last_sum,stacks,sum,tuple,x;formatted=_this.time_format(t);tuple=counts_by_date[formatted];if(!tuple){return{date:formatted,min:0,max:0,stacks:[]}}sum=0;stacks=function(){var k,len1,ref1,results;ref1=tuple.counts;results=[];for(idx=k=0,len1=ref1.length;k<len1;idx=++k){count=ref1[idx];last_sum=sum;sum+=count.count;x={cap:sum===tuple.count,date:tuple.date,min:last_sum,max:sum};x[this.secondary_field()]=count[this.secondary_field()];results.push(x)}return results}.call(_this);if(!(tuple.count>0)){return}return{date:tuple.date,min:0,max:tuple.count,stacks:stacks}}}(this))};StackedBarGrapher.prototype.popup_position=function(hitbox){var point_offset,x,y;point_offset=hitbox.position();x=Math.floor(point_offset.left);y=Math.floor(point_offset.top);return[x,y]};StackedBarGrapher.prototype.on_show_popup=function(popup,hitbox){var current_bars,game_bars,secondary_id;secondary_id=hitbox.data(this.secondary_field());if(!secondary_id){this.on_hide_popup();return}this.el.addClass("highlighting_bar");game_bars=this.el.find(".game_bar");current_bars=game_bars.filter("[data-"+this.secondary_field()+"='"+secondary_id+"']");game_bars.css({opacity:.1});return current_bars.css({opacity:""})};StackedBarGrapher.prototype.on_hide_popup=function(popup,hitbox){return this.el.removeClass("highlighting_bar").find(".game_bar").css({opacity:""})};StackedBarGrapher.prototype.draw_area=function(data){var bar_stack,bar_stacks,bar_width,bl,br,colors,g,item,j,len,position_bars,secondary_ids,stack;bl=this.get_range()[0];br=d3.time.day.offset(bl,1);bar_width=this._x_scale(br)-this._x_scale(bl);colors=d3.scale.ordinal().range(this.opts.colors||["#FA5C5C","#E85757","#EB7070","#EF8888","#F4ADAD","#F9C1C1"]);data=data.filter(function(d){return d.min!==d.max});secondary_ids={};for(j=0,len=data.length;j<len;j++){item=data[j];secondary_ids[item[this.secondary_field()]]=true}secondary_ids=function(){var results;results=[];for(g in secondary_ids){results.push(+g)}return results}();colors=colors.domain(secondary_ids);stack=this.svg.append("g").attr("class","bars").selectAll("g").data(data).enter().append("g");position_bars=function(_this){return function(group,expand){if(expand==null){expand=0}return group.attr("x",function(d){var x;x=_this.get_x_scaled(d);return-expand+Math.floor(x-(bar_width-5)/2)}).attr("y",function(d){return _this._y_scale(d.max)-expand}).attr("width",bar_width-5+expand*2).attr("height",function(d){return 2*expand+Math.max(1,_this._y_scale(d.min)-_this._y_scale(d.max))})}}(this);bar_stack=stack.attr("class","bar_stack");position_bars(bar_stack.append("rect").attr("class","total_border"),1);position_bars(bar_stack.append("rect").attr("class","total_bar"));bar_stacks=stack.append("g").attr("class","game_counts").selectAll("rect").data(function(d){return d.stacks}).enter();position_bars(bar_stacks.append("rect").attr("class",function(_this){return function(d){var base,c;c="game_bar hitbox";if(typeof(base=_this.opts).group_url==="function"?base.group_url(d):void 0){c+=" link"}return c}}(this)).attr("data-"+this.secondary_field(),function(_this){return function(d){return d[_this.secondary_field()]}}(this)).attr("fill",function(_this){return function(d){return colors(d[_this.secondary_field()])}}(this)).attr("data-popup_template","bar_popup_template").attr("data-popup",function(_this){return function(d){return JSON.stringify({date:_this.popup_date.apply(_this,arguments),label:_this.bar_popup_label.apply(_this,arguments),group:(_this.opts.popup_group||_this.popup_group).apply(null,arguments)})}}(this)));return position_bars(bar_stacks.append("rect").attr("class","bar_border")).attr("height",function(d){if(d.cap){return 0}else{return 1}})};return StackedBarGrapher}(I.BarGrapher)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityArchiveTopicLightbox=function(superClass){extend(CommunityArchiveTopicLightbox,superClass);function CommunityArchiveTopicLightbox(){this.init=bind(this.init,this);return CommunityArchiveTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityArchiveTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityArchiveTopicLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityBanLightbox=function(superClass){extend(CommunityBanLightbox,superClass);function CommunityBanLightbox(){this.init=bind(this.init,this);return CommunityBanLightbox.__super__.constructor.apply(this,arguments)}CommunityBanLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return _this.el.addClass("after_ban")}}(this))};return CommunityBanLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityBlocks=function(){function CommunityBlocks(el){this.el=$(el);this.el.remote_link(function(_this){return function(res){if(res.errors){I.flash(res.erorrs.join(", "),"error")}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}return CommunityBlocks}()}).call(this);(function(){I.CommunityCategory=function(){function CommunityCategory(el){this.el=$(el);this.el.dispatch("click",{rules_link:function(_this){return function(){return _this.el.addClass("rules_visible")}}(this)})}return CommunityCategory}()}).call(this);(function(){I.CommunityCategoryBans=function(){function CommunityCategoryBans(el){this.el=$(el);this.el.remote_link(function(_this){return function(res){if(res.errors){alert(res.errors.join("\n"));return}return window.location.reload()}}(this))}return CommunityCategoryBans}()}).call(this);(function(){I.CommunityCategoryModerators=function(){function CommunityCategoryModerators(el){this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(res.return_to){return window.location=res.return_to}}}(this))}return CommunityCategoryModerators}()}).call(this);(function(){I.CommunityProfile=function(){function CommunityProfile(el,opts){var c;this.el=$(el);I.has_follow_button(this.el);this.carousels=function(){var i,len,ref,results;ref=this.el.find(".game_carousel_widget");results=[];for(i=0,len=ref.length;i<len;i++){c=ref[i];results.push(new I.GameCarousel($(c)))}return results}.call(this);new I.CommunityViewTopic(this.el.find(".recent_posts"),opts)}return CommunityProfile}()}).call(this);(function(){I.CommunityEditCategory=function(){function CommunityEditCategory(el){var form;this.el=$(el);I.redactor(this.el.find("textarea"),{minHeight:100});this.setup_tag_editor();form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}CommunityEditCategory.prototype.setup_tag_editor=function(){var tag_editor,tags;tag_editor=this.el.find(".category_tag_editor");if(!tag_editor.length){return}tags=tag_editor.data("tags");return ReactDOM.render(R.Community.CategoryEditTags({tags:tags}),tag_editor[0])};return CommunityEditCategory}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityLockTopicLightbox=function(superClass){extend(CommunityLockTopicLightbox,superClass);function CommunityLockTopicLightbox(){this.init=bind(this.init,this);return CommunityLockTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityLockTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityLockTopicLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityNewTopic=function(){function CommunityNewTopic(el,opts){var form;this.el=$(el);I.redactor(this.el.find("textarea"),$.extend({minHeight:100},opts.redactor_opts));try{this.el.find("input[name=offset]").val((new Date).getTimezoneOffset())}catch(error){}this.set_fingerprint();form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}CommunityNewTopic.prototype.set_fingerprint=function(){if(!window.Fingerprint2){return false}this.set_fingerprint=function(){};return(new Fingerprint2).get(function(_this){return function(res){if(res){return _this.el.find("input[name=bfp]").val(res)}}}(this))};return CommunityNewTopic}()}).call(this);(function(){I.CommunityPostForm=function(){function CommunityPostForm(el,opts){var form;if(opts==null){opts={}}this.el=$(el);I.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),$.extend({minHeight:50,focus:!!opts.focus},opts.redactor_opts))}}(this));form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){window.location=res.redirect_to}if(res.flash){return I.flash(res.flash)}}}(this))}return CommunityPostForm}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityReportPostLightbox=function(superClass){extend(CommunityReportPostLightbox,superClass);function CommunityReportPostLightbox(){this.init=bind(this.init,this);return CommunityReportPostLightbox.__super__.constructor.apply(this,arguments)}CommunityReportPostLightbox.prototype.init=function(){var form;return form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return _this.el.addClass("submitted_report")}}(this))};return CommunityReportPostLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityStickTopicLightbox=function(superClass){extend(CommunityStickTopicLightbox,superClass);function CommunityStickTopicLightbox(){this.init=bind(this.init,this);return CommunityStickTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityStickTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityStickTopicLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityTopicHeader=function(){function CommunityTopicHeader(el,opts){var moderation;this.opts=opts;this.render_topic_voter=bind(this.render_topic_voter,this);this.el=$(el);moderation=this.el.find(".moderation_tools");if(moderation.length){new I.CommunityTopicModerationTools(moderation,this.opts.moderation)}this.render_topic_voter()}CommunityTopicHeader.prototype.render_topic_voter=function(){var props,ref,voter;if(!(typeof R!=="undefined"&&R!==null?(ref=R.Community)!=null?ref.TopicVoter:void 0:void 0)){return}voter=this.el.find(".community_topic_voter_widget");if(!voter.length){return}props=voter.data("p");props.vote_url=this.opts.vote_url;return ReactDOM.render(R.Community.TopicVoter(props),voter[0])};return CommunityTopicHeader}()}).call(this);(function(){I.CommunityTopicList=function(){function CommunityTopicList(el,opts){this.opts=opts;this.el=$(el);new I.CommunityTopicModerationTools(el,this.opts);this.el.lazy_images({selector:"[data-background_image]"});this.render_topic_voters();this.el.has_tooltips();new I.GamePopups(this.el)}CommunityTopicList.prototype.render_topic_voters=function(){var i,len,props,ref,ref1,results,voter;if(!(typeof R!=="undefined"&&R!==null?(ref=R.Community)!=null?ref.TopicVoter:void 0:void 0)){return}ref1=this.el.find(".community_topic_voter_widget");results=[];for(i=0,len=ref1.length;i<len;i++){voter=ref1[i];props=$(voter).data("p");props.vote_url=this.opts.vote_url;results.push(ReactDOM.render(R.Community.TopicVoter(props),voter))}return results};return CommunityTopicList}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityTopicModerationTools=function(){CommunityTopicModerationTools.prototype.topic_url=function(route,topic_id){return this.opts.urls[route].replace(/:topic_id\b/,topic_id)};function CommunityTopicModerationTools(el,opts){this.opts=opts;this.topic_url=bind(this.topic_url,this);this.el=$(el);new I.FilterPickers(el);this.el.on("click",".filter_option",function(_this){return function(e){var target,topic_id,value;if($(e.target).is("a")){return}e.preventDefault();target=$(e.currentTarget).trigger("i:close_filter_pickers");topic_id=target.closest("[data-topic_id]").data("topic_id");value=target.data("value");switch(value){case"archive":case"unarchive":return I.Lightbox.open_remote(_this.topic_url("archive_topic",topic_id),I.CommunityArchiveTopicLightbox);case"lock":case"unlock":return I.Lightbox.open_remote(_this.topic_url("lock_topic",topic_id),I.CommunityLockTopicLightbox);case"stick":case"unstick":return I.Lightbox.open_remote(_this.topic_url("stick_topic",topic_id),I.CommunityStickTopicLightbox);case"delete":if(confirm("Are you sure you want to delete this topic?")){return $.ajax({url:_this.topic_url("delete_topic",topic_id),data:I.with_csrf(),type:"post",xhrFields:{withCredentials:true}}).done(function(res){if(res.errors){return alert(res.errors.join())}return window.location.reload()})}}}}(this))}return CommunityTopicModerationTools}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityViewTopic=function(){CommunityViewTopic.prototype.vote_counts_template=I.lazy_template(CommunityViewTopic,"vote_counts");function CommunityViewTopic(el,opts){this.opts=opts;this.update_votes=bind(this.update_votes,this);this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(el.is(".vote_btn")){if(res.errors){alert(res.errors.join(", "));return}_this.update_votes(el,res);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this));this.el.dispatch("click",{ban_user_btn:function(_this){return function(btn){var ban_url,post;post=btn.closest(".community_post").data("post");ban_url=_this.opts.ban_url+("?banned_user_id="+post.user_id);return I.Lightbox.open_remote(ban_url,I.CommunityBanLightbox)}}(this),stick_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityStickTopicLightbox)}}(this),lock_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityLockTopicLightbox)}}(this),report_post_btn:function(_this){return function(btn){var post,url;post=btn.closest(".community_post").data("post");url=_this.opts.report_url.replace(/:post_id/,post.id);return I.Lightbox.open_remote(url,I.CommunityReportPostLightbox)}}(this)})}CommunityViewTopic.prototype.update_votes=function(el,res){var i,len,like_button,post,v,voters;post=el.closest(".community_post");voters=post.find(".vote_btn");like_button=voters.filter(".post_action");like_button.removeClass("animate_bounce animate_drop_down");setTimeout(function(_this){return function(){return like_button.removeClass("animate_bounce animate_drop_down")}}(this),500);if(el.is(".voted")){_.defer(function(_this){return function(){return like_button.addClass("animate_drop_down")}}(this));el.removeClass("voted")}else{_.defer(function(_this){return function(){return like_button.addClass("animate_bounce")}}(this));voters.removeClass("voted").filter(el).addClass("voted")}for(i=0,len=voters.length;i<len;i++){v=voters[i];v=$(v);if(v.is(".voted")){v.data("params").action="remove"}else{delete v.data("params").action}}return post.find(".vote_counts").html(this.vote_counts_template({up_score:res.up_score+Math.max(0,res.score_adjustment),down_score:res.down_score+Math.abs(Math.min(0,res.score_adjustment))}))};return CommunityViewTopic}()}).call(this);
